---
# permalink: "Posts"
layout: single

title: 'Vue - Ngrok'
excerpt: 'Vue-handbook'

author_profile: false

header:
  overlay_image: https://images.unsplash.com/photo-1501785888041-af3ef285b470?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1350&q=80
  overlay_filter: 0.5 # 투명도

data: 2021-11-16 11:48:00 +0900
last_modified_at: 2021-11-16 11:48:00 +0900

categories:
  - post
tags:
  - Vue
  - ngrok
  - devServer
---

## Ngrok 사용하여 Vue 개발하기

특정 API 또는 소셜 인증을 할 때 로컬환경이라 제한이 생겨서 테스트가 안된다. 이럴 때 ngrok를 통해 임시 도메인을 붙일 수 있다.

그 과정을 기록한다.

1. ngrok 설치

   - 여러가지 다운로드 방법이 있지만 나는 ngrok node package를 전역으로 설치를 했다.

   ```
    npm i -g ngork
   ```

2. ngrok 실행

   - 간단 실행 (8시간 뒤 세션이 만료됨)

   ```
   ngrok http 7070
   ```

   - 영구 실행

     - `httsp://www.ngrok.com`에서 회원가입 후 `https://dashboard.ngrok.com/login` 로그인을 한다.
     - 대시보드 메뉴에서 Getting Started > Your Authtoken 메뉴를 클릭한다.
     - 토큰을 복사한 후 터미널에서 아래의 명령어를 입력한다.

     ```
     ngrok authtoken 토큰
     ```

     - 토큰을 저장 후 다시 ngrok 실행

     ```
     ngrok http 7070
     ```

     - 실행 결과 화면

     ```
     Session Status                online
     Account                       ltg@bbangyanetworks.com (Plan: Free)
     Version                       2.3.40
     Region                        United States (us)
     Web Interface                 http://127.0.0.1:4040
     Forwarding                    http://9d9d-121-131-44-118.ngrok.io -> http://localhost:7070
     Forwarding                    https://9d9d-121-131-44-118.ngrok.io -> http://localhost:7070

     Connections                   ttl     opn     rt1     rt5     p50     p90
                                 126     0       0.00    0.00    1.59    26.38

     HTTP Requests
     ```

3. vue config

   - 포워딩된 주소를 브라우저 주소입력란에 붙여넣으면 하얀 화면애 'Invalid Host header'라는 문구만 표시된다.
   - 이 문구는 개발모드로 띄어진 devServer가 로컬 접속은 허용되지만 외부 접속은 허용되지 않도록 기본설정이 되어 있기 때문이었다.
   - vue.config.js에서 아래 문장을 추가해주면 외부에서도 접속이 가능하다.

     ```
     module.exports = {
         devServer: {
             disableHostCheck: true
         }
     };
     ```

4. 크롬 브라우저 설정

   - 포워딩된 주소를 크롬브라우저 주소입력란에 붙여넣으면 아래와 같은 경고 문구가 표시된다.
     <img data-action="zoom"  style="margin-top: 10px;" src='{{ "/assets/images/deceptive-site-google-warning-message.jpg" | relative_url }}' alt='relative' />
   - 크롬 setting > Privacy and security > Safe Browsing의 상태를
     'Standard protection'에서 'No protection'으로 바꾸니 더 이상 위의 화면이 나타나지 않긴 했는데 이 기능을 끄는 건 좋지 않을 것같아 다시 켜두었다. 다시 사이트에 접속하니 해당 화면이 뜨지 않는다.
     다른 브라우저에서는 발생하지 않는 현상이라 크롬 보안 정책에 걸린 것으로 추측된다.

5. CORS Error

   - 개발자 도구의 콘솔을 보면 "The request client is not a secure context and the resource is in more-private address space 'private'"라는 에러가 감지된다.
   - [chrome://flags/#block-insecure-private-network-requests](chrome://flags/#block-insecure-private-network-requests)에 접속하여 아래와 같이 'Block insecure private network requests' 항목을 검색한 후 Disabled로 설정한다.
     <img data-action="zoom"  style="margin-top: 10px;" src='{{ "/assets/images/Block-insecure-private-network-requests.png" | relative_url }}' alt='relative' />

6. 접속
   - 이제 로컬로 띄운 서버에도 SSL이 적용되어 sns 인증 뿐만 아니라 httpOnly, secure 쿠키도 사용가능해서 인증 유지도 된다.
     <img data-action="zoom"  style="margin-top: 10px;" src='{{ "/assets/images/ngrok-success.png" | relative_url }}' alt='relative' />
